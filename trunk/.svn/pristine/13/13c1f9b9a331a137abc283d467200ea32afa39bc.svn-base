function banner () {
	var swiper = new Swiper('.swiper-container', {
		nextButton: '.swiper-button-next',
		prevButton: '.swiper-button-prev',
		pagination: '.swiper-pagination',
		paginationType: 'fraction'
	});

	if ($('.swiper-slide').length <= 1) {
		$('.swiper-pagination').remove();
	}
}

var timer = null;
var timeLeft = 0;

function countDown () {

	var countdown = parseInt($('#countdown').attr('countdown'));
	timeLeft = countdown - moment().valueOf();

	clearTimeout(timer);
	if (timeLeft === 0) {
		clearTimeout(timer);
		// 倒计时为0 时候执行的操作
		return false;
	}
	var days = parseInt(timeLeft / 1000 / 60 / 60 / 24, 10);
	var hours = parseInt(timeLeft / 1000 / 60 / 60 % 24, 10);
	var minutes = parseInt(timeLeft / 1000 / 60 % 60, 10);
	var seconds = parseInt(timeLeft / 1000 % 60, 10);
	timeLeft = timeLeft - 1000;
	var startDay = '';
	var startHour = '';
	var startMin = '';
	var startSec = '';

	if (days <= 0) {
		startDay = '';
	} else {
		var showDay = days > 9 ? minutes : '0' + days;
		startDay = showDay + '天';
	}

	if (hours <= 0) {
		startHour = '00: ';
	} else {
		var showHour = days > 9 ? hours : '0' + hours;
		startHour = showHour + ': ';
	}

	if (minutes <= 0) {
		startMin = '00: ';
	} else {
		var showMin = minutes > 9 ? minutes : '0' + minutes;
		startMin = showMin + ': ';
	}

	if (seconds <= 0) {
		startSec = '00';
	} else {
		var showSec = seconds > 9 ? seconds : '0' + seconds;
		startSec = showSec;
	}
	$('#countdown').html(startHour + startMin + startSec);
	setTimeout(countDown, 1000);
}

function progress () {
	var current = $('#currentNumber').html();
	var currentNumber = parseInt(current.substr(0, current.length - 1));
	var total = parseInt($('#total').html());
	$('#progress').css({'width': (currentNumber / total) * 100 + '%'})
}

function tabs () {
	$('#tabs').off().on('click', 'a', function () {
		$('.pic-content').hide();
		$('#tabs a').removeClass('active');
		$('#tabs a').eq($(this).index()).addClass('active');
		$('.pic-content').eq($(this).index()).show();
	});
}

function getMoreService () {
	$('#more').on('click', function () {
		$('#servicePopup').show();
	});
}

function getSpec () {
	$('#specPopup').show();
	checkShowBtn();
	var specList = $('.spec-list');
	for (var i = 0; i < specList.length; i++) {
		specList.eq(i).attr('index', i);
		specList.eq(i).off().on('click', 'li', function () {
			var index = parseInt($(this).parent().attr('index'));
			specList.eq(index).find('li').removeClass('active');
			$(this).parent().attr('value', $(this).attr('value'));
			$(this).addClass('active');
			checkShowBtn();
		});
	}
}

function checkShowBtn () {
	var arr = [];
	var specList = $('.spec-list');
	for (var i = 0; i < specList.length; i++) {
		var val = specList.eq(i).attr('value');
		if (val) {
			arr.push(val);
		}
	}
	var btn = $('#buyNow');
	if (arr.length === specList.length) {
		btn.show();
		// 选中了所有的规格
		btn.off().on('click', function (ev) {
			ev.stopPropagation();
			console.log(arr);
		});
	} else {
		btn.hide();
	}
}

// 选择规格
function spec () {
	$('#selectSpec').off().on('click', function () {
		getSpec();
	});
}


// 点击购买
function buy () {
	$('#buy').on('click', function () {
		if(!canBuy){
			getSpec();
		}
	});
}


buy();
getMoreService();
tabs();
spec();
progress();
countDown();
banner();