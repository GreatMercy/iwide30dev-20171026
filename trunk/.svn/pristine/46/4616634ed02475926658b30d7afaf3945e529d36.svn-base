<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<link href="<?php echo base_url(FD_PUBLIC) ?>/js/art_Dialog/skins/default.css" rel="stylesheet" />
<!--[if lt IE 9]>
    <script src="<?php echo base_url(FD_PUBLIC) ?>/js/html5shiv.min.js"></script>
    <script src="<?php echo base_url(FD_PUBLIC) ?>/js/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="<?php echo base_url(FD_PUBLIC) ?>/datepicker/css/bootstrap-datepicker.min.css">
<script src="<?php echo base_url(FD_PUBLIC) ?>/datepicker/js/bootstrap-datepicker.min.js"></script>
<script type="text/javascript">
    //全局变量
    var GV = {
        DIMAUB: "<?php echo base_url();?>",
        JS_ROOT: "<?php echo FD_PUBLIC ?>/js/",
    };
</script>
<script src="<?php echo base_url(FD_PUBLIC) ?>/js/validate.js"></script>
<script src="<?php echo base_url(FD_PUBLIC) ?>/js/wind.js"></script>

<link rel='stylesheet' href='<?php echo base_url(FD_PUBLIC) ?>/css/global.css'>
<style>
input,select{border:none !important}
select{-webkit-appearance:menulist-button}
body,html{background:#f0f3f6}
.bd,.bdright,.input{border:1px solid #d7e0f1}
.bdright{border-width:0 1px 0 0 ;}
.input{padding:0px 8px; width:300px;}
.padding10{padding:10px}
.padding20{padding:20px}
.list>*{margin-bottom:10px}
.list>*:last-child{margin-bottom:0px}
.color_999{ color:#d4d7db;}
.input_item>*:first-child{min-width:4em}
</style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
    <?php /* 顶部导航 */ echo $block_top; ?>

    <?php /* 左栏菜单 */ echo $block_left; ?>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper"  style="color:#7e8e9f;">
        <div class="banner bg_fff p_0_20">编辑分类or新增分类</div>
        <section class="content">
                <?php echo $this->session->show_put_msg(); ?>
		<?php echo form_open(EA_const_url::inst()->get_url('*/*/actset_edit'), array('class'=>'form-inline')); ?>
        <input type="hidden" name='id' value='<?php echo isset($set['id'])?$set['id']:''?>' />
        <input type="hidden" name='reward_id' value='<?php echo isset($set['reward_id'])?$set['reward_id']:''?>' />
        <table class="bg_fff _w bd">
        	<tr>
            	<td class="center bdright" style="width:260px;">
                	<span style="border-left:4px solid #3f51b5; padding:4px 7px;">基本信息</span>
                </td>
            	<td class="padding20 list">
                
                	<div class="input_item flex">
                    	<div class="txt_r marginr">活动名称</div>
                        <div class="marginr input flex flexgrow"><input type="text" value='<?php echo isset($set['name'])? $set['name']:''?>' name="name" /></div>
                    </div>                 
                	<div class="input_item flex">
                    	<div class="txt_r marginr">开始时间</div>
                		<div class="marginr input flex flexgrow"><input class="date" placeholder="<?php echo date('Y-m-d');?>" type="text" name="start_time"  value='<?php echo isset($set['start_time'])?$set['start_time']:''?>'/></div>
                    </div>                 
                	<div class="input_item flex">
                    	<div class="txt_r marginr">结束时间</div>
                		<div class="marginr input flex flexgrow"><input class="date" placeholder="<?php echo date('Y-m-d');?>" type="text" name="end_time"  value='<?php echo isset($set['end_time'])?$set['end_time']:''?>' /></div>
                    </div>
                </td>
            </tr>
        </table>
        <table class="bg_fff _w bd martop">
        	<tr>
            	<td class="center bdright" style="width:260px;">
                	<span style="border-left:4px solid #ff503f; padding:4px 7px;">玩法配置</span>
                </td>
            	<td class="padding20 list">
                	<div class="input_item flex">
                    	<div class="txt_r marginr">玩法分类</div>
                		<div>
                            <label style="cursor:pointer" class="marginr">
                            	<input type="radio" style="display:none" <?php if(isset($set['mode']) && $set['mode']=='1') echo 'checked';?> <?php if(!isset($set['mode'])) echo 'checked';?> name="mode" value="1" />
                            	<span class="diyradio"><tt></tt></span>
                                积分玩法（默认)</label>
                            <label style="cursor:pointer">
                                <input type="radio" style="display:none" name="mode" <?php if(isset($set['mode']) && $set['mode']=='2') echo 'checked';?> value="2" />
                            	<span class="diyradio"><tt></tt></span>
                                排行榜玩法</label>
                        </div>
                    </div>                    
                	<div class="input_item flex mode1">
                    	<div class="txt_r marginr">点数奖励</div>
                		<div class="marginr input flex flexgrow">
                        	<div><input type="text" name="invite_gold" value="<?php if(isset($set['invite_gold']) && !empty($set['invite_gold'])) echo $set['invite_gold'];?>" /></div>
                        	<div class="txt_r color_999">点数/新会员</div>
                        </div>
                    </div>                 
                	<div class="input_item flex mode1">
                    	<div class="txt_r marginr">点数兑换</div>
                		<div class="marginr input flex flexgrow" style="width:130px">
                        	<div><input type="text" name="full_gold" value="<?php if(isset($set['full_gold']) && !empty($set['full_gold'])) echo $set['full_gold'];?>"  /></div>
                        	<div class="txt_r color_999" style="width:50px;">点数</div>
                        </div>
                    	<div class="txt_r marginr">兑换</div>
                		<div class="marginr input flex flexgrow" style="width:125px;">
                        	<div><select name="exchange_card" style="width:100%">
                                <option value="0">请选择兑换券</option>
                                <?php foreach ($exchange_card as $key=>$val){?>
                                    <option value="<?php echo $val['card_id']?>" <?php if(isset($set['mode']) && $set['mode']=='1' && isset($set['exchange_card']) && $set['exchange_card']==$val['card_id']):?> selected <?php endif;?>><?php echo $val['title']?></option>
                                <?php }?>
                            </select></div>
                            </div>
                        </div>
                    </div>          
                	<div class="input_item flex mode1">
                    	<div class="txt_r marginr">兑换说明</div>
                		<div class="marginr input flex flexgrow"><input type="text" name="exchange_note" value="<?php if(isset($set['exchange_note'])) echo $set['exchange_note'];?>" /></div>
                    </div>         
                	<div class="input_item flex mode2">
                    	<div class="txt_r marginr">活动奖励</div>
                    	<div class="txt_r marginr">榜单前</div>
                		<div class="marginr input flex flexgrow" style="width:74px">
                        	<div><input type="text" name="full_gold" value="<?php if(isset($set['full_gold']) && !empty($set['full_gold'])) echo $set['full_gold'];?>" /></div>
                        	<div class="txt_r color_999">名</div>
                        </div>
                    	<div class="txt_r marginr">可获得</div>
                		<div class="marginr input flex flexgrow" style="width:125px;">
                        	<div><select name="exchange_card" style="width:100%">
                                    <option value="0">请选择兑换券</option>
                                <?php foreach ($exchange_card as $key=>$val){?>
                                    <option value="<?php echo $val['card_id']?>" <?php if(isset($set['mode']) && $set['mode']=='2' && isset($set['exchange_card']) && $set['exchange_card']==$val['card_id']):?> selected <?php endif;?>><?php echo $val['title']?></option>
                                <?php }?>
                            </select></div>
                            </div>
                        </div>
                    </div>  
                    <div class="color_999 mode2">活动奖励将在活动结束后生成最终排行名单，请在排行榜中发奖。 </div>

                </td>
            </tr>
        </table>
        <table class="bg_fff _w bd martop">
        	<tr>
            	<td class="center bdright" style="width:260px;">
                	<span style="border-left:4px solid #4caf50; padding:4px 7px;">奖励配置</span>
                </td>
            	<td class="padding20 list">
                	<div class="input_item flex">
                    	<div class="txt_r marginr">老会员</div>
                		<div><label style="cursor:pointer" class="marginr">
                            	<input type="radio" <?php if(isset($set['old_reward_type']) && $set['old_reward_type']=='0'):?>checked<?php endif;?><?php if(!isset($set['old_reward_type']) && empty($set['old_reward_type'])):?>checked<?php endif;?> style="display:none" name="old_reward_type" value="0" />
                            	<span class="diyradio"><tt></tt></span>
                                无奖励（默认)</label>
                            <label style="cursor:pointer">
                                <input type="radio"  style="display:none" <?php if(isset($set['old_reward_type']) && $set['old_reward_type']=='1'):?>checked<?php endif;?>  name="old_reward_type" value="1" />
                            	<span class="diyradio"><tt></tt></span>
                                排行榜玩法</label>
                        </div>
                    </div>     
                                
                	<div class="input_item flex">
                    	<div class="txt_r marginr">所属门店</div>
                		<div class="marginr input flex flexgrow">
                        <select style="width:100%" >
                                <option></option>
                        </select></div>
                    </div>       
                	<div class="input_item flex">
                    	<div class="txt_r marginr">关键字</div>
                		<div class="marginr input flex flexgrow">
                        <select style="width:100%" >
                                <option></option>
                        </select></div>
                    </div>       
                	<div class="input_item flex">
                    	<div class="txt_r marginr">排序</div>
                		<div class="marginr input flex flexgrow"><input type="text"  /></div>
                    </div>
                </td>
            </tr>
        </table>
        <div class="bg_fff bd center martop padding"><button type="submit" class="btn_main bdradius dosave" id="sub_btn">保存分类</button></div>         
                    <!-- /.box-footer -->
                <?php echo form_close() ?>
            </div>
        </section><!-- /.content -->
        <script>
        $(function(){

			var submit_tag=true;
            $('.date').datepicker({
				startDate:new Date(),
				format: "yyyy-mm-dd"
            });
			function diyshow(){
				$('.mode1').hide();
				$('.mode2').hide();
				$('.mode'+$('input[name=mode]:checked').val()).show();
			}
			$('input[name=mode]').change(diyshow);
			diyshow();
            Wind.use("ajaxForm","artDialog",function () {
                $(document).on('click', '#sub_btn', function (e) {
                    e.preventDefault();
                    var _this = this, ok_url = "<?php echo EA_const_url::inst()->get_url('*/*/');?>", btn = $(this);
                    var form = $('.form-inline'), form_url = form.attr("action");
                    //ie处理placeholder提交问题
                    if ($.support.msie) {
                        form.find('[placeholder]').each(function () {
                            var input = $(this);
                            if (input.val() == input.attr('placeholder')) {
                                input.val('');
                            }
                        });
                    }

                    form.ajaxSubmit({
                        url: form_url,
                        dataType: 'json',
                        beforeSubmit: function (arr, $form, options) {
                            /*验证提交数据*/
                            var _null=false,_msg='',inputo=0,st=0,et=0;
                            for (i in arr) {
                                var name = arr[i].name, value = $.trim(arr[i].value);
                                inputo = $("input[name='"+name+"']");
                                switch (name) {
                                    case 'start_time':
                                        st = value;
                                        if (!value) {
                                            _null = true;
                                            _msg = '请输入开始时间';
                                        }
                                        break;
                                    case 'end_time':
                                        et = value;
                                        if (!value) {
                                            _null = true;
                                            _msg = '请输入结束时间';
                                        }
                                        break;
                                    case 'name':
                                        if (!value) {
                                            _null = true;
                                            _msg = '请输入活动名称';
                                        }
                                        break;
                                }
                                if (_null === true) break;
                            }

                            if (_null === true) {
                                inputo.focus();
                                return false;
                            }
                            if(st>=et) {
                                art.dialog({
                                    title:'提示',
                                    icon:'warning',
                                    content:'结束时间必须大于开始时间',
                                    time:3,
                                    ok:false,
                                    cancel:false
                                });
                                return false;
                            }
                            /*end*/
                            var text = btn.text();
                            btn.prop('disabled', true).addClass('disabled').text(text + '中...');
                        },
                        success: function (data) {
                            if (data.status == 1) {
                                var btnval = data.data.isadd === false ? '编辑' : '添加';
                                art.dialog({
                                    title: '提示',
                                    fixed: true,
                                    icon: 'succeed',
                                    content: data.message,
                                    okVal: "返回列表页",
                                    cancelVal: '继续' + btnval,
                                    ok: function () {
                                        window.location.href = data.data.url;
                                    },
                                    cancel: function () {
                                        window.location.reload();
                                    },
                                    close: function () {
                                        $(_this).focus(); //关闭时让触发弹窗的元素获取焦点
                                        return true;
                                    },
                                });
                            } else {
                                btn.parent().append("<span style='color: #ff0040;'>" + data.message + "</span>");
                                setTimeout(function () {
                                    btn.parent().find('span').fadeOut('normal', function () {
                                        btn.parent().find('span').remove();
                                    });
                                }, 3000);
                            }
                        },
                        complete: function () {
                            var text = btn.text();
                            btn.prop('disabled', false).removeClass('disabled').text(text.replace('中...', ''));
                        },
                        error: function () {
                            btn.parent().append("<span style='color: #ff0040;'>请求异常,请刷新页面试试!</span>");
                            setTimeout(function () {
                                btn.parent().find('span').fadeOut('normal', function () {
                                    btn.parent().find('span').remove();
                                });
                            }, 3000);
                        }
                    });
                });
            });
		});
        </script>
    </div><!-- /.content-wrapper -->
    <?php /* Footer Block @see footer.php */ require_once VIEWPATH. $tpl .DS .'privilege'. DS. 'footer.php'; ?>
    <?php /* Right Block @see right.php */ require_once VIEWPATH. $tpl .DS .'privilege'. DS. 'right.php'; ?>
</div><!-- ./wrapper -->
<?php /* Right Block @see right.php */ require_once VIEWPATH. $tpl .DS .'privilege'. DS. 'commonjs.php'; ?>
</body>
</html>
